<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NovaChat | Accesso</title>
  <style>
    :root {
      --bg: #0d0f17;
      --panel: rgba(20, 23, 35, 0.72);
      --panel-strong: rgba(29, 32, 47, 0.85);
      --text: #f5f6ff;
      --muted: #c3c7d8;
      --accent: #9d6bff;
      --accent-2: #5cf0ff;
      --danger: #ff6b9b;
      --success: #8df7c5;
      --border: rgba(255, 255, 255, 0.06);
      --glow: 0 16px 40px rgba(111, 111, 255, 0.35);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at 20% 20%, rgba(157, 107, 255, 0.24), transparent 40%),
        radial-gradient(circle at 80% 15%, rgba(92, 240, 255, 0.2), transparent 32%),
        radial-gradient(circle at 50% 80%, rgba(255, 107, 155, 0.18), transparent 30%),
        var(--bg);
      color: var(--text);
      display: grid;
      place-items: center;
      padding: 32px 16px;
      overflow: hidden;
      position: relative;
      isolation: isolate;
    }

    .grain {
      position: fixed;
      inset: 0;
      opacity: 0.26;
      pointer-events: none;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" stitchTiles="stitch"/></filter><rect width="160" height="160" filter="url(%23n)" opacity="0.55"/></svg>');
      mix-blend-mode: soft-light;
      z-index: -1;
    }

    .orb {
      position: absolute;
      width: 320px;
      height: 320px;
      border-radius: 50%;
      filter: blur(70px);
      opacity: 0.55;
      z-index: -1;
      animation: float 12s ease-in-out infinite alternate;
    }

    .orb.one { background: rgba(157, 107, 255, 0.4); top: -60px; left: -40px; animation-delay: 0.5s; }
    .orb.two { background: rgba(92, 240, 255, 0.4); top: 40%; right: -120px; animation-duration: 14s; }
    .orb.three { background: rgba(255, 107, 155, 0.38); bottom: -80px; left: 18%; animation-duration: 16s; }

    @keyframes float {
      from { transform: translateY(-12px) scale(1); }
      to { transform: translateY(16px) scale(1.05); }
    }

    .card-wrap {
      position: relative;
      width: min(440px, 96vw);
    }

    .splash {
      position: absolute;
      inset: -30%;
      background: radial-gradient(circle at 50% 40%, rgba(157, 107, 255, 0.35), transparent 45%),
                  radial-gradient(circle at 40% 60%, rgba(92, 240, 255, 0.3), transparent 48%),
                  radial-gradient(circle at 65% 70%, rgba(255, 107, 155, 0.32), transparent 48%);
      filter: blur(50px) saturate(1.3);
      opacity: 0.55;
      z-index: 0;
      animation: splash 9s ease-in-out infinite;
      transform-origin: 60% 40%;
    }

    @keyframes splash {
      0% { transform: scale(0.95) rotate(-2deg); opacity: 0.55; }
      50% { transform: scale(1.05) rotate(2deg); opacity: 0.7; }
      100% { transform: scale(0.98) rotate(-3deg); opacity: 0.6; }
    }

    .card {
      position: relative;
      z-index: 1;
      background: linear-gradient(160deg, var(--panel), var(--panel-strong));
      border: 1px solid var(--border);
      box-shadow: var(--glow), 0 32px 90px rgba(0, 0, 0, 0.5);
      border-radius: 20px;
      padding: 32px 30px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      backdrop-filter: blur(14px) saturate(1.3);
    }

    .logo {
      width: 64px;
      height: 64px;
      border-radius: 18px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.12), transparent 50%),
                  radial-gradient(circle at 70% 70%, rgba(255,255,255,0.08), transparent 45%),
                  linear-gradient(145deg, #2a233c, #171422);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04), 0 14px 30px rgba(0,0,0,0.35);
      display: grid;
      place-items: center;
      margin-bottom: 4px;
    }

    .logo svg { width: 32px; height: 32px; filter: drop-shadow(0 0 12px rgba(157, 107, 255, 0.8)); }

    h1 { font-size: 26px; letter-spacing: -0.4px; }
    .subtitle { color: var(--muted); line-height: 1.5; }

    form { display: flex; flex-direction: column; gap: 12px; }

    label { font-weight: 700; font-size: 14px; color: #e9ebff; letter-spacing: 0.2px; }

    .input {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 14px;
      color: var(--text);
      font-weight: 600;
      transition: border 0.18s ease, box-shadow 0.18s ease, transform 0.12s ease;
    }

    .input:focus {
      outline: none;
      border-color: rgba(92, 240, 255, 0.5);
      box-shadow: 0 0 0 2px rgba(92, 240, 255, 0.16), 0 12px 32px rgba(92, 240, 255, 0.14);
      transform: translateY(-1px);
    }

    .btn {
      cursor: pointer;
      border: none;
      border-radius: 12px;
      padding: 14px 16px;
      color: #0d0f17;
      font-weight: 800;
      font-size: 15px;
      background: linear-gradient(120deg, var(--accent), #c06bff, var(--accent-2));
      background-size: 220% 220%;
      animation: shimmer 6s ease-in-out infinite;
      box-shadow: var(--glow);
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }

    .btn:hover { transform: translateY(-1px); box-shadow: 0 20px 50px rgba(157,107,255,0.35); }
    .btn:active { transform: translateY(1px); }

    @keyframes shimmer {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .switcher { font-size: 14px; color: var(--muted); }
    .switcher button { background: none; border: none; color: var(--accent-2); font-weight: 700; cursor: pointer; }

    .status {
      min-height: 22px;
      font-size: 14px;
      font-weight: 700;
    }
    .status.error { color: var(--danger); }
    .status.success { color: var(--success); }
    .status.muted { color: var(--muted); }

    .session {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      border-radius: 14px;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-weight: 700;
    }

    .session button {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.12);
      color: var(--text);
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: border 0.16s ease, color 0.16s ease;
    }

    .session button:hover { border-color: rgba(92, 240, 255, 0.6); color: var(--accent-2); }

    .datastore-hint { color: var(--muted); font-size: 13px; line-height: 1.4; }
  </style>
</head>
<body>
  <div class="grain"></div>
  <div class="orb one"></div>
  <div class="orb two"></div>
  <div class="orb three"></div>

  <div class="card-wrap">
    <div class="splash" aria-hidden="true"></div>
    <div class="card" role="main">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
          <path fill="#9d6bff" d="M26 11.4c2.4 5.4 2.4 11.8 0 17.2-1.6 3.6-4 6.8-7 9.4 3 2.6 5.4 5.8 7 9.4 2.4 5.4 2.4 11.8 0 17.2C23.6 59.2 19.2 56 14 54c-5.2-2-11.2-3-14-3l2-12c1 0 6.4-1 10.6-2.6C18.8 33.6 22.2 28.2 24 22c1.6-5.4 1.6-11 0-16.4l2-1.2Z"/>
          <path fill="#5cf0ff" d="M38 52.6c-2.4-5.4-2.4-11.8 0-17.2 1.6-3.6 4-6.8 7-9.4-3-2.6-5.4-5.8-7-9.4-2.4-5.4-2.4-11.8 0-17.2C40.4 4.8 44.8 8 50 10c5.2 2 11.2 3 14 3l-2 12c-1 0-6.4 1-10.6 2.6-6.2 2.8-9.6 8.2-11.4 14.4-1.6 5.4-1.6 11 0 16.4l-2 1.2Z"/>
        </svg>
      </div>
      <div>
        <h1 id="form-title">NovaChat</h1>
        <p class="subtitle" id="form-subtitle">Crea il tuo account per entrare nella chat. Nessuna email, solo username e password.</p>
      </div>

      <div id="session" class="session" hidden>
        <span id="session-text"></span>
        <button id="logout">Esci</button>
      </div>

      <form id="auth-form">
        <div>
          <label for="username">Username</label>
          <input id="username" class="input" name="username" autocomplete="username" required />
        </div>
        <div>
          <label for="password">Password</label>
          <input id="password" class="input" type="password" name="password" autocomplete="current-password" required />
        </div>
        <button type="submit" class="btn" id="submit-btn">Crea account</button>
        <div class="status" id="status"></div>
      </form>

      <div class="switcher">
        <span id="switch-copy">Hai già un account?</span>
        <button id="switch-btn" type="button">Accedi</button>
      </div>

      <p class="datastore-hint">I dati vengono salvati nel DataStore locale del browser. Gli username sono unici: se un nome è già stato scelto, lo vedrai segnalato immediatamente.</p>
    </div>
  </div>

  <script>
    const DataStore = (() => {
      const USERS_KEY = 'novachat-users-v2';
      const SESSION_KEY = 'novachat-session';

      const loadUsers = () => {
        try {
          const raw = localStorage.getItem(USERS_KEY);
          if (!raw) return {};
          const parsed = JSON.parse(raw);
          return typeof parsed === 'object' && parsed ? parsed : {};
        } catch (err) {
          console.error('Impossibile leggere il DataStore', err);
          return {};
        }
      };

      const saveUsers = (users) => localStorage.setItem(USERS_KEY, JSON.stringify(users));

      let users = loadUsers();

      const setSession = (username) => sessionStorage.setItem(SESSION_KEY, username);
      const clearSession = () => sessionStorage.removeItem(SESSION_KEY);
      const getSession = () => sessionStorage.getItem(SESSION_KEY);

      return {
        register(username, password) {
          if (users[username]) {
            return { ok: false, message: 'Questo username è già in uso. Scegline un altro.' };
          }
          users[username] = { password };
          saveUsers(users);
          setSession(username);
          return { ok: true };
        },
        login(username, password) {
          const user = users[username];
          if (!user || user.password !== password) {
            return { ok: false, message: 'Credenziali non valide. Ritenta.' };
          }
          setSession(username);
          return { ok: true };
        },
        logout() { clearSession(); },
        currentUser() { return getSession(); },
      };
    })();

    const form = document.getElementById('auth-form');
    const status = document.getElementById('status');
    const switchBtn = document.getElementById('switch-btn');
    const switchCopy = document.getElementById('switch-copy');
    const submitBtn = document.getElementById('submit-btn');
    const title = document.getElementById('form-title');
    const subtitle = document.getElementById('form-subtitle');
    const sessionBanner = document.getElementById('session');
    const sessionText = document.getElementById('session-text');
    const logoutBtn = document.getElementById('logout');
    const usernameField = document.getElementById('username');
    const passwordField = document.getElementById('password');

    let mode = 'signup';

    function setMode(next) {
      mode = next;
      const isSignup = mode === 'signup';
      title.textContent = isSignup ? 'NovaChat' : 'Bentornato su NovaChat';
      subtitle.textContent = isSignup
        ? 'Crea il tuo account per entrare nella chat. Nessuna email, solo username e password.'
        : 'Accedi con il tuo username. Gli account vengono salvati in locale.';
      submitBtn.textContent = isSignup ? 'Crea account' : 'Accedi';
      switchCopy.textContent = isSignup ? 'Hai già un account?' : 'Non hai ancora un account?';
      switchBtn.textContent = isSignup ? 'Accedi' : 'Registrati';
      status.textContent = '';
      status.className = 'status';
      usernameField.focus();
    }

    function showSession(username) {
      sessionBanner.hidden = false;
      sessionText.textContent = `Sei autenticato come ${username}`;
    }

    function hideSession() {
      sessionBanner.hidden = true;
      sessionText.textContent = '';
    }

    const sessionUser = DataStore.currentUser();
    if (sessionUser) {
      showSession(sessionUser);
      setMode('login');
    }

    form.addEventListener('submit', (event) => {
      event.preventDefault();
      const username = usernameField.value.trim();
      const password = passwordField.value.trim();
      if (!username || !password) return;

      const action = mode === 'signup' ? DataStore.register : DataStore.login;
      const result = action(username, password);

      status.className = 'status ' + (result.ok ? 'success' : 'error');
      status.textContent = result.ok
        ? mode === 'signup'
          ? 'Account creato e salvato in modo sicuro nel DataStore locale.'
          : 'Login effettuato con successo.'
        : result.message;

      if (result.ok) {
        showSession(username);
        passwordField.value = '';
      } else {
        hideSession();
      }
    });

    switchBtn.addEventListener('click', () => {
      setMode(mode === 'signup' ? 'login' : 'signup');
    });

    logoutBtn.addEventListener('click', () => {
      DataStore.logout();
      hideSession();
      status.textContent = 'Sessione terminata.';
      status.className = 'status muted';
    });

    setMode(mode);
  </script>
</body>
</html>
